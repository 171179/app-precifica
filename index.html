<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Precifica Gold | Sistema Integrado</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <!-- SheetJS for Excel Import -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <i class="fa-solid fa-gem mobile-icon"></i>
                <span>Precifica<span class="text-gold">SaaS</span></span>
            </div>

            <!-- Status Card Removed (Moved to Dashboard Widgets) -->

            <nav>
                <a href="#" id="nav-products" class="active" onclick="switchView('products')"><i
                        class="fa-solid fa-table-columns"></i> Dashboard</a>
                <a href="#" id="nav-settings" onclick="switchView('settings')"><i class="fa-solid fa-sliders"></i>
                    Configurações</a>
                <a href="#" id="nav-help" onclick="switchView('help')"><i class="fa-regular fa-circle-question"></i>
                    Ajuda & Tutorial</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="content">
            <header class="top-bar">
                <div class="header-titles">
                    <h2>Gestão de Preços</h2>
                    <p class="subtitle" id="pageSubtitle">Dashboard Geral</p>
                </div>

                <div class="actions-bar">
                    <div class="status-badge" id="appStatus">
                        <span class="dot"></span> Sistema Online
                    </div>
                </div>
            </header>

            <!-- VIEW: SETTINGS -->
            <div id="view-settings" class="view-section hidden">
                <div class="card settings-panel">
                    <h3><i class="fa-solid fa-sliders"></i> Configurações do Sistema</h3>
                    <div class="form-grid">
                        <div class="field">
                            <label>Fator de Banho</label>
                            <input type="number" id="platingFactor" step="0.001">
                            <small class="hint">Referência: 0.02 = 2% do valor do ouro</small>
                        </div>
                        <div class="divider"
                            style="grid-column: span 2; margin: 1rem 0; border-top: 1px solid var(--border);"></div>

                        <!-- GitHub Config Fields -->
                        <div class="field">
                            <label>GitHub Token <small>(Personal Access Token)</small></label>
                            <input type="password" id="ghToken" placeholder="ghp_...">
                        </div>
                        <div class="field">
                            <label>Usuário / Organização</label>
                            <input type="text" id="ghOwner" placeholder="Ex: usuario">
                        </div>
                        <div class="field">
                            <label>Repositório</label>
                            <input type="text" id="ghRepo" placeholder="Ex: precifica-db">
                        </div>
                        <div class="field">
                            <label>Caminho do Arquivo <small>(Pasta/Nome.json)</small></label>
                            <input type="text" id="ghPath" placeholder="Ex: dados/produtos.json">
                        </div>
                    </div>
                    <div class="gh-actions-panel">
                        <button id="btnLoadGithub" class="btn-secondary"><i class="fa-solid fa-cloud-download-alt"></i>
                            Baixar Dados</button>
                        <button id="btnSaveGithub" class="btn-primary"><i class="fa-solid fa-cloud-upload-alt"></i>
                            Salvar Dados</button>
                        <span id="ghStatus" class="status-text">Não conectado</span>
                    </div>
                </div>
            </div>

            <!-- VIEW: HELP -->
            <div id="view-help" class="view-section hidden">
                <div class="help-container">
                    <div class="help-hero">
                        <h3><i class="fa-solid fa-book-open"></i> Como usar o Sistema</h3>
                        <p>Entenda cada campo e como o cálculo da sua semijoia é feito.</p>
                    </div>

                    <div class="help-grid">
                        <!-- Card: Logica -->
                        <div class="card help-card">
                            <div class="icon-box warning"><i class="fa-solid fa-flask"></i></div>
                            <h4>O Fator de Banho</h4>
                            <p>O <strong>Fator de Banho (ex: 0.02)</strong> é a "taxa de conversão" que transforma o
                                preço do Ouro Puro (24k) no preço que sua galvanoplastia cobra.</p>
                            <div class="formula-box">
                                <code>Custo = Peso x Camada x Ouro(g) x Fator</code>
                            </div>
                            <p class="small-text">Exemplo: Se o ouro está R$ 475 e o fator é 0.02 (2%), o custo é R$
                                9,50 por grama/milésimo.</p>
                        </div>

                        <!-- Card: Passo a Passo -->
                        <div class="card help-card">
                            <div class="icon-box primary"><i class="fa-solid fa-list-check"></i></div>
                            <h4>Preenchendo a Tabela</h4>
                            <ul class="help-list">
                                <li><strong>SKU:</strong> Código único do seu produto (Ex: AN01).</li>
                                <li><strong>Custo Bruto:</strong> Quanto você pagou na peça crua (no bruto).</li>
                                <li><strong>Peso (g):</strong> Peso da peça em gramas.</li>
                                <li><strong>Banho (mil):</strong> Quantos milésimos de ouro ela vai receber (Ex: 5, 10).
                                </li>
                                <li><strong>Margem %:</strong> Quanto de lucro você quer ter sobre o custo total.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: PRODUCTS (DASHBOARD) -->
            <div id="view-products" class="view-section">

                <!-- Summary Widgets (InfraUtils Style) -->
                <div class="dashboard-widgets">
                    <div class="widget">
                        <div class="widget-info">
                            <span class="widget-label">Cotação Ouro (24k)</span>
                            <span class="widget-value text-gold" id="widgetGoldPrice">R$ --</span>
                            <span class="widget-sub" id="goldLastUpdate">Atualizado Agora <i class="fa-solid fa-rotate"
                                    onclick="fetchLiveGoldPrice()" style="cursor:pointer"></i></span>
                        </div>
                        <div class="widget-icon bg-gold-light">
                            <i class="fa-solid fa-coins text-gold"></i>
                        </div>
                    </div>

                    <div class="widget">
                        <div class="widget-info">
                            <span class="widget-label">Total Produtos</span>
                            <span class="widget-value" id="widgetTotalProducts">0</span>
                            <span class="widget-sub">Itens Cadastrados</span>
                        </div>
                        <div class="widget-icon bg-blue-light">
                            <i class="fa-solid fa-box text-primary"></i>
                        </div>
                    </div>

                    <div class="widget">
                        <div class="widget-info">
                            <span class="widget-label">Custo do Banho (Médio)</span>
                            <span class="widget-value" id="widgetAvgPlating">R$ --</span>
                            <span class="widget-sub">Por grama/milésimo</span>
                        </div>
                        <div class="widget-icon bg-green-light">
                            <i class="fa-solid fa-droplet text-success"></i>
                        </div>
                    </div>
                </div>

                <div class="card grid-card">
                    <div class="grid-header">
                        <h3>Inventário de Peças</h3>
                        <div class="header-actions">
                            <div class="search-container">
                                <i class="fa-solid fa-search"></i>
                                <input type="text" id="searchInput" placeholder="Pesquisar..."
                                    onkeyup="handleSearch(this.value)">
                            </div>
                            <button class="btn-sm btn-secondary" onclick="exportToCSV()"
                                title="Exportar para Excel/CSV">
                                <i class="fa-solid fa-file-excel"></i> Exportar</button>

                            <button id="btnDeleteSelected" class="btn-sm btn-danger hidden" onclick="deleteSelected()"
                                title="Deletar Selecionados (Lixeira)"><i class="fa-solid fa-trash-can"></i></button>

                            <!-- Import Excel -->
                            <input type="file" id="importExcel" accept=".xlsx, .xls" style="display:none"
                                onchange="handleImportExcel(this)">
                            <button class="btn-sm btn-secondary"
                                onclick="document.getElementById('importExcel').click()"
                                title="Importar Planilha XLSX"><i class="fa-solid fa-file-import"></i> Importar</button>
                            <button class="btn-sm btn-secondary" onclick="handleLoadGithub()"
                                title="Baixar dados do GitHub"><i class="fa-solid fa-cloud-download-alt"></i>
                                Carregar</button>
                            <button class="btn-sm btn-secondary" onclick="handleSaveGithub()"><i
                                    class="fa-solid fa-cloud-upload-alt"></i> Salvar</button>
                            <button class="btn-sm btn-primary" onclick="addRow()"><i class="fa-solid fa-plus"></i> Novo
                                Produto</button>
                        </div>
                    </div>

                    <div class="table-container">
                        <table id="gridTable">
                            <thead>
                                <tr></tr>
                                <th class="text-center" style="width: 40px;"><input type="checkbox" id="selectAll"
                                        onclick="toggleSelectAll(this)"></th>
                                <th class="text-left" style="width: 90px;">SKU</th>
                                <th class="text-left" style="min-width: 380px;">Produto</th>
                                <th class="text-left" style="width: 120px;">Fornecedor</th>
                                <th class="text-left" style="width: 120px;">Galvanoplastia</th>
                                <th style="width: 110px;">Custo Bruto</th>
                                <th style="width: 80px;">Peso (g)</th>
                                <th style="width: 90px;">Banho (mil)</th>
                                <th style="width: 110px; background: #f8fafc;">R$ Banho</th>
                                <th style="width: 110px; background: #f8fafc;">Total Custo</th>
                                <th style="width: 90px;">Margem %</th>
                                <th style="width: 130px; color: var(--primary);">Preço Venda</th>
                                <th style="width: 50px;"></th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Rows rendered by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </main>
    </div>
    <script src="script.js"></script>
</body>

</html>